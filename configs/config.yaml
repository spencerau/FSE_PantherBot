# Academic Advisor RAG System Configuration
system:
  name: "Fowler School of Engineering Academic Advisor"
  version: "1.0.0"
  description: "Unified collection-based RAG system for academic advising"

# Qdrant Vector Database Configuration
qdrant:
  host: "localhost"
  port: 6333
  timeout: 150
  collections:
    major_catalogs: "major_catalogs"
    minor_catalogs: "minor_catalogs"
    general_knowledge: "general_knowledge"
    4_year_plans: "4_year_plans"

data:
  # major_catalogs_path: "data/major_catalogs"
  # minor_catalogs_path: "data/minor_catalogs"
  major_catalog_json_path: "data/major_catalog_json"
  # minor_catalog_json_path: "data/minor_catalog_json"
  general_knowledge_path: "data/general_knowledge"
  4_year_plans: "data/4_year_plans"

# Cluster Configuration
cluster:
  enabled: false
  # For SSH + container deployment
  ssh_host: "dgx0.chapman.edu"
  ssh_user: "spau"
  ssh_port: 22
  
  container_name: "ollama-spencerau"
  ollama_host: "localhost"
  ollama_port: 11434
  
  max_retries: 3
  retry_delay: 5
  health_check_interval: 30
  
  gpu_enabled: true
  memory_limit: "80g"
  gpu_memory_fraction: 0.8

# Embedding Configuration
embedding:
  # compute cluster embedding model
  # model: "bge-m3:567m"
  # local laptop embedding model  
  model: "nomic-embed-text"
  
  #chunk_size: 2000
  #chunk_overlap: 250
  batch_size: 32
  ollama_host: "localhost"
  ollama_port: 11434
  add_prefixes: true
  lowercase: false
  normalize_unicode: true
  collapse_whitespace: true
  dehyphenate: true

# Chunker Configuration
chunker:
  strategy: "recursive"
  target_tokens: 1000
  min_tokens: 500
  overlap_ratio: 0.1
  respect_headings: true

# LLM Configuration
llm:
  # Cluster deployment with larger model
  # model: "deepseek-r1:70b"
  # Local development fallback
  model: "gemma3:4b"
  # model: "cogito:3b"
  temperature: 0.2
  top_p: 0.7
  max_tokens: 6000
  timeout: 600  # Increased timeout for larger model
  system_prompt: >
    You are an expert AI academic advisor for the Fowler School of Engineering at Chapman University.
    
    Your role is to provide accurate, helpful guidance to undergraduate students about:
    - Degree requirements and graduation planning
    - Course schedules and availability
    - Prerequisites and course sequencing
    - Academic policies and procedures
    - Program-specific information
    
    IMPORTANT GUIDELINES:
    - Use the information provided in the context from university catalogs as your primary source
    - When you have relevant context, provide specific and detailed answers based on that information
    - Be specific about course codes, credit hours, and requirements when available in the context
    - If the context contains partial information, provide what you can and note what might be missing
    - Only recommend contacting academic advisors if the context truly lacks the needed information
    - Be supportive and encouraging in your responses
    - Focus on the student's specific program and catalog year when provided
    - Trust the context provided - it comes from official university documents
    
    Format your responses clearly and be thorough when you have good context to work with.

    Courses are numbered as follows:
    001-099 Remedial courses and courses not appropriate for college degree credit but designed to meet specific needs of individuals or groups where degree credit is not required. Remedial
    courses are noncredit courses.
    100-299 Lower-division courses for first-year and sophomore levels; first-year level 100-199 and sophomore level 200-299.
    129, 229, 329, 429 These numbers indicate experimental coursework offered by a department. Experimental courses are designed to offer additional opportunities to explore areas and subjects
    of special interest and may be repeated for credit if course content is different. Course topics, prerequisites and credits may vary. Some courses require student lab fees. Specific course details
    will be listed in the course schedule.
    194, 394 These numbers indicate coursework offered through the Chapman Study Abroad program. Courses have been approved for credit but do not equate to any regular Chapman courses.
    199, 299, 399, 499 Individual study courses.
    290, 490 Internship courses.
    291, 491 Student-faculty research and creative activity courses.
    300-399 Upper-division courses for junior and senior levels. Sophomores may enroll provided they meet prerequisites and restrictions. First-year students are admitted with written consent of
    instructor and chair of department offering the course.
    400-499 Upper-division courses for junior and senior levels. First-year students may not enroll. 
    500-699 Graduate courses for graduate students and seniors meeting specific guidelines.
    700-799 Post-masterâ€™s and doctoral courses

    For study abroad, as long as courses come over as upper division, they can count for our upper division courses.

    If the study abroad course isn't upper division, it can count for the course but the student will need to take another upper division class to fulfill the number of upper division courses.

    To graduate, students must take at least 42 upper division units.

    If a course is offered every semester, that means it's offered both in the fall and in the spring.

    Students may take up to 18 credits each semester.

# Retrieval Configuration
retrieval:
  top_k: 10
  rerank_top_k: 8
  enable_reranking: true 
  
  # OLD: Hardcoded chunk allocation (commented out for dynamic system)
  # major_catalogs_chunks: 9
  # minor_catalogs_chunks: 0
  # 4_year_plans_chunks: 0
  
  # NEW: Dynamic chunk allocation per collection type
  collection_weights:
    major_catalogs: 0.5
    minor_catalogs: 0.15
    4_year_plans: 0.25
    general_knowledge: 0.35
  
  # Minimum chunks per collection when active
  min_chunks_per_collection: 5
  max_chunks_per_collection: 20
  
  # Total retrieval budget (will be distributed dynamically)
  total_retrieval_budget: 40
  
  k_dense: 50
  k_sparse: 50
  rrf_k: 60
  fuse_weights:
    dense: 0.7 # semantic search (nomic embed/something sexier on compute cluster)
    sparse: 0.3

# Reranker Configuration
reranker:
  model: "xitao/bge-reranker-v2-m3"
  top_k: 10
  batch_size: 32
  pdf_weight: 1.0
  course_weight: 1.0
  max_candidates_for_rerank: 200
  top_k_rerank: 12
  activation: "sigmoid"

# mcp:
#   host: "127.0.0.1"
#   port: 8765
#   transport: "stdio"